# 项目名称：Travel Odyssey—— 个人旅行足迹可视化系统

**版本号：** v1.0 | **状态：** 规划中 | **作者**：XiaxuChen

------

## 1. 项目背景与目标

### 1.1 背景

用户热爱旅游，积累了海量带有 GPS 信息的照片数据。现有的商业软件（如 Polarsteps）虽然易用，但存在数据隐私隐患、定制化程度低、视觉效果不够极客（缺乏 3D 地形、数据可视化深度不足）等问题。

### 1.2 核心目标

构建一个**私有化部署 (Self-Hosted)**、**高性能**、**高交互性**的 Web 系统。

- **数据主权：** 照片与元数据完全本地存储。
- **视觉震撼：** 基于 WebGL 的 3D 地球渲染，支持数万级海量点聚合、飞线动画。
- **自动化：** 实现从“文件夹”到“地图”的全自动 ETL (Extract, Transform, Load) 流程。

------

## 2. 技术架构概览

- **前端 (Presentation Layer):** Next.js (React) + TypeScript
  - *可视化引擎:* Mapbox GL JS (底图) + Deck.gl (高性能数据图层, 处理 10w+ 点无压力)
- **后端 (Logic Layer):** FastAPI (Python)
  - *任务队列:* Celery + Redis (处理图片上传、缩略图生成、EXIF 提取等耗时任务)
- **数据层 (Data Layer):** PostgreSQL + PostGIS
  - *文件存储:* 本地文件系统 / MinIO (可选)
- **运维 (DevOps):** Docker Compose 全栈容器化

------

## 3. 功能需求

### 3.1 核心模块一：数据摄入与处理

这是系统的基石，需要处理复杂的现实世界数据。

| **功能点**        | **详细描述**                                                 | **优先级** |
| ----------------- | ------------------------------------------------------------ | ---------- |
| **批量上传/扫描** | 支持前端拖拽上传，或指定服务器本地路径进行扫描（适合 NAS 场景）。 | P0         |
| **HEIC/Raw 解码** | 针对 iPhone 用户，后端必须内置 `pyheif` 或 `imagein` 库，将 HEIC 转换为 WebP/JPG 用于展示。 | P0         |
| **元数据提取**    | 提取 EXIF：经度、纬度、海拔(Altitude)、拍摄时间、设备型号、焦段。 | P0         |
| **时空聚类**      | 后端算法根据时间阈值（如：相隔 4 小时）和距离阈值，自动将照片归类为一次“Trip (旅程)”。 | P1         |
| **缩略图生成**    | 生成多级缩略图（Thumbnail, Preview），保留原图用于下载，提升前端加载速度。 | P1         |

### 3.2 核心模块二：地图可视化

这是核心界面，采用深色系的 HUD (平视显示器) 风格。

| **功能点**                | **详细描述**                                                 | **优先级** |
| ------------------------- | ------------------------------------------------------------ | ---------- |
| **暗黑 3D 地球**          | 默认加载 Mapbox Dark 样式，支持地形 (Terrain) 渲染，倾斜视角可见山脉起伏。 | P0         |
| **动态聚合 (Clustering)** | 缩小时显示聚合数字圈（如 "50"），放大时炸开为具体照片点。    | P0         |
| **时空飞线 (ArcLayer)**   | 根据时间顺序，在地点之间绘制 3D 弧线。颜色随时间渐变（如：清晨是冷色，黄昏是暖色）。 | P1         |
| **热力图 (Heatmap)**      | 渲染足迹密度的热力分布，高亮展示常去区域。                   | P2         |
| **沉浸式漫游**            | 点击“播放旅程”，摄像机视角自动跟随轨迹移动，模拟飞行俯瞰视角。 | P2         |

### 3.3 核心模块三：交互与画廊

| **功能点**       | **详细描述**                                                 | **优先级** |
| ---------------- | ------------------------------------------------------------ | ---------- |
| **照片弹窗**     | 点击地图上的点，弹出带有地点信息、时间的照片预览卡片。       | P0         |
| **瀑布流相册**   | 侧边栏支持按“时间”或“地点”查看照片墙，点击照片地图自动定位。 | P1         |
| **元数据仪表盘** | 可视化统计面板：去过的国家数、总里程、使用最多的相机型号、海拔最高的照片等。 | P2         |

------

## 4. 数据模型设计 

利用 PostGIS 的强大能力，将地理位置作为几何对象存储。

### 4.1 Table: `photos`

| **字段名**     | **类型**                   | **说明**                      |
| -------------- | -------------------------- | ----------------------------- |
| `id`           | UUID                       | 主键                          |
| `filename`     | VARCHAR                    | 文件名                        |
| `storage_path` | VARCHAR                    | 本地存储路径                  |
| `taken_at`     | TIMESTAMP                  | 拍摄时间 (带时区)             |
| **`geom`**     | **GEOMETRY(POINTZ, 4326)** | **核心：经纬度+海拔 (3D点)**  |
| `camera_make`  | VARCHAR                    | 相机厂商 (e.g., Apple)        |
| `trip_id`      | UUID                       | 关联的旅程 ID (外键)          |
| `metadata`     | JSONB                      | 其他 EXIF 杂项 (光圈、快门等) |

### 4.2 Table: `trips` (自动或手动生成的旅程)

| **字段名**       | **类型**                       | **说明**                             |
| ---------------- | ------------------------------ | ------------------------------------ |
| `id`             | UUID                           | 主键                                 |
| `name`           | VARCHAR                        | 旅程名称 (e.g., "2024 Japan Winter") |
| `start_date`     | TIMESTAMP                      | 开始时间                             |
| `end_date`       | TIMESTAMP                      | 结束时间                             |
| `cover_photo_id` | UUID                           | 封面图 ID                            |
| **`route_path`** | **GEOMETRY(LINESTRING, 4326)** | **轨迹线 (PostGIS 自动生成)**        |

------

## 5. UI/UX 设计概念

- **主色调：** Deep Space Blue / Carbon Black (#000000, #1a1a1a).
- **强调色：** Neon Cyan (赛博蓝) 用于轨迹，Sunset Orange (落日橙) 用于当前选中点。
- **布局：** 全屏地图 (Full-screen Map) 为主。
  - *左侧：* 悬浮式透明侧边栏 (Glassmorphism)，包含时间轴控制器。
  - *右下：* 迷你仪表盘 (当前经纬度、海拔、当前查看的照片参数)。
- **动效：** 所有数据加载不是生硬出现，而是 fade-in 或 grow-in；地图移动要有惯性阻尼感。

------

## 6. API 接口规划 (API Endpoints Draft)

### Photos

- `POST /api/v1/photos/upload`: 上传照片 (触发后台任务)
- `GET /api/v1/photos/geojson`: 获取 GeoJSON 格式的所有点数据 (供 Deck.gl 使用)
  - *Query Params:* `start_date`, `end_date`, `bounds` (地图可视区域)

### Stats

- `GET /api/v1/stats/summary`: 获取总里程、国家数等
- `GET /api/v1/trips/{id}/path`: 获取某次旅行的完整 3D 路径

------

## 7. 扩展性规划 (Future Steps for a Researcher)

这个项目预留了 AI 接口：

1. **Semantic Search (语义搜索):** 利用 CLIP 模型，实现“搜索‘雪山’”直接在地图上高亮所有雪山照片，无需手动打标签。
2. **Real-SR Integration:** 前端查看大图时，可调用你自己的 Real-World Super-Resolution 模型 API，实时增强老照片画质。
3. **Auto-Captioning:** 使用 VLM (如 LLaVA) 自动为照片生成描述，作为游记文案。

------

### 